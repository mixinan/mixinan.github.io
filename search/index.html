<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!--  -->
  
  <title>万码千钧Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
<link rel="stylesheet" href="/css/style.css">

  
  
<!-- Busuanzi Analytics -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- End Busuanzi Analytics -->

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <div id="menu">
  <a class="main-nav-link" href="/">首页</a>
  <a class="main-nav-link" href="/archives">文章</a>
  <a class="main-nav-link" href="/about">作者</a>
  <div id="search-form-wrap">
    <form class="search-form" action="/search/" method="get">
      <input type="text" class="search-form-input" placeholder="搜索" name="q">
    </form>
  </div>
</div>
      <div class="outer">
        <section id="main"><div class="search-result">
  <h1>搜索结果</h1>
  <div id="search-results"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const query = urlParams.get('q');
  
  // 添加调试信息
  console.log('搜索关键词:', query);
  
  if (query) {
    // 显示正在搜索的提示
    document.getElementById('search-results').innerHTML = '<p>正在搜索 "' + query + '"...</p>';
    
    // 记录开始时间
    const startTime = performance.now();
    
    fetch('/search.xml')
      .then(response => {
        console.log('fetch响应状态:', response.status);
        if (!response.ok) {
          throw new Error('网络响应错误: ' + response.status);
        }
        return response.text();
      })
      .then(str => {
        const fetchTime = performance.now();
        console.log('获取XML耗时:', fetchTime - startTime, 'ms');
        console.log('获取到的XML内容长度:', str.length);
        // 检查返回的内容是否为空
        if (!str) {
          throw new Error('搜索文件为空');
        }
        
        // 解析XML
        const parser = new DOMParser();
        const data = parser.parseFromString(str, "text/xml");
        
        // 检查解析是否成功
        if (data.getElementsByTagName('parsererror').length > 0) {
          console.error('XML解析错误:', data.getElementsByTagName('parsererror')[0].textContent);
          throw new Error('XML解析错误');
        }
        
        // 获取所有文章条目
        const entries = data.getElementsByTagName('entry');
        console.log('总文章数:', entries.length);
        
        const results = [];
        const lowerQuery = query.toLowerCase();
        
        // 限制搜索的文章数量，提升性能
        const maxEntries = Math.min(entries.length, 100);
        console.log('搜索文章数量限制:', maxEntries);
        
        // 遍历文章进行搜索（性能优化版本）
        for (let index = 0; index < maxEntries; index++) {
          try {
            const entry = entries[index];
            const titleElement = entry.getElementsByTagName('title')[0];
            const contentElement = entry.getElementsByTagName('content')[0];
            const urlElement = entry.getElementsByTagName('url')[0];
            
            const title = titleElement ? titleElement.textContent : '';
            const content = contentElement ? contentElement.textContent : '';
            const url = urlElement ? urlElement.textContent : '';
            
            // 性能优化：只在标题或内容长度合理时进行搜索
            if (title.length > 0 || content.length > 0) {
              // 进一步性能优化：只搜索前5000个字符的内容
              const searchContent = content.length > 5000 ? content.substring(0, 5000) : content;
              
              // 清理内容，移除HTML标签和特殊字符
              const cleanTitle = title.toLowerCase().replace(/<[^>]*>/g, '').trim();
              const cleanContent = searchContent.toLowerCase().replace(/<[^>]*>/g, '').trim();
              
              // 检查标题或内容是否包含搜索词（性能优化版本）
              if (cleanTitle.includes(lowerQuery) || cleanContent.includes(lowerQuery)) {
                results.push({
                  title: title,
                  content: content,
                  url: url
                });
                console.log('匹配文章: ' + title);
              }
            }
            
            // 如果已经找到足够多的结果，提前结束搜索
            if (results.length >= 20) {
              console.log('已找到足够多的结果，提前结束搜索');
              break;
            }
          } catch (e) {
            console.error('处理文章 ' + index + ' 时出错:', e);
          }
        }
        
        const searchTime = performance.now();
        console.log('搜索耗时:', searchTime - fetchTime, 'ms');
        console.log('搜索完成，找到 ' + results.length + ' 个结果');
        displayResults(results, query);
      })
      .catch(error => {
        console.error('搜索请求失败:', error);
        document.getElementById('search-results').innerHTML = '<p>搜索请求失败：' + error.message + '</p>';
      });
  } else {
    document.getElementById('search-results').innerHTML = '<p>请输入搜索关键词</p>';
  }
});

function displayResults(results, query) {
  const resultsContainer = document.getElementById('search-results');
  
  if (results.length === 0) {
    resultsContainer.innerHTML = '<div class="search-result-info">未找到与 "' + query + '" 相关的结果。</div>';
    return;
  }
  
  let html = '<div class="search-result-info">找到 ' + results.length + ' 个相关结果：</div>';
  results.forEach(result => {
    // 提取内容预览（性能优化：限制预览长度）
    const preview = result.content.length > 200 ? 
      result.content.substring(0, 200) + '...' : result.content;
    
    // 清理标题和内容中的HTML标签
    const cleanTitle = result.title.replace(/<[^>]*>/g, '').trim();
    const cleanPreview = preview.replace(/<[^>]*>/g, '').trim();
    
    html += `
      <div class="search-result-item">
        <h2><a href="${result.url}" target="_blank">${cleanTitle}</a></h2>
        <div class="search-result-content">${cleanPreview}</div>
        <a class="search-result-url" href="${result.url}" target="_blank">${result.url}</a>
      </div>
    `;
  });
  
  resultsContainer.innerHTML = html;
}
</script></section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最近发布</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/01/25/2024zongjie/">2024年总结</a>
          </li>
        
          <li>
            <a href="/2023/08/19/jianfei-1/">减肥12斤</a>
          </li>
        
          <li>
            <a href="/2022/12/31/2022/">2022年个人总结</a>
          </li>
        
          <li>
            <a href="/2022/12/29/covid19/">核酸阳性的经历</a>
          </li>
        
          <li>
            <a href="/2022/12/07/1207/">后疫情时代</a>
          </li>
        
          <li>
            <a href="/2022/09/21/weibo2022/">2022微博收录</a>
          </li>
        
          <li>
            <a href="/2022/09/05/2022running/">21K 跑团</a>
          </li>
        
          <li>
            <a href="/2022/01/09/yiqing/">西安疫情</a>
          </li>
        
          <li>
            <a href="/2021/05/14/chengtizhong/">减肥期间，如何称一个满意的体重</a>
          </li>
        
          <li>
            <a href="/2021/05/12/shenghuo-tips/">生活经验</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">热门文章</h3>
    <div class="widget popular-posts">
      <ul>
        
          <li>
            <a href="/2018/05/01/clean-hair/">程序员脱发问题讨论</a>
            <span class="post-date">2018-05-01</span>
          </li>
        
          <li>
            <a href="/2017/02/06/di-tie-jian-wen/">地铁见闻</a>
            <span class="post-date">2017-02-06</span>
          </li>
        
          <li>
            <a href="/2016/12/20/2016-nianhui-jiemu/">2016年会节目稿（未上）</a>
            <span class="post-date">2016-12-20</span>
          </li>
        
          <li>
            <a href="/2018/08/06/chuanjiang/">关于串讲</a>
            <span class="post-date">2018-08-06</span>
          </li>
        
      </ul>
    </div>
  </div>

  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">一月 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">八月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">十一月 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">文章</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>





<script src="/js/script.js"></script>







  <div class="busuanzi-count">
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      访客数
    </span>
    
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      浏览量
    </span>
    
    
  </div>

  </div>
</body>
</html>